{% extends "main/base.html" %}
{% block title %}{% endblock %}
{% block description %}{% endblock %}
{% block content %}
    <div class="container">
        <div class="blog-header">
            <h1 class="blog-title">Event Calendar&nbsp;<a class="btn btn-default" href="/event/create">Add Event</a></h1>
        </div>
        <div class="row">
            <div class="col-sm-6 blog-main">
                {{ calendar|safe }}
            </div>
            <div class="col-sm-6 blog-main" id="event-feed">
              <button class="btn btn-lg btn-warning"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Loading...</button>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            $(document).on("click", "td.aday", function () {
                $(".selected").removeClass("selected");
                $(this).addClass("selected");
            });
            $(document).on("click", "th.cmonth", function () {
                location.href = "/?month=" + $(this).attr("id");
            });
            $.ajax({url: "/feed/events",
            }).done(function(data){
              var feed_html = "<h2>"+data.title+"</h2>";
              var feed_template = `
                <div class="blog-post">
                    <h3 class="blog-post-title">$title</h3>
                    <p>$date</p>
                    <p>$description</p>
                    <a type="button" class="btn btn-default" aria-label="Left Align" href="/event/update/$key">
                      <span class="glyphicon glyphicon-pencil" aria-hidden="true">Edit</span>
                    </a>
                </div>
                <hr/>
              `;
              $.each(data.events, function(i, val){
                var localTime  = moment.utc(val.date).toDate();
                localTime = moment(localTime).format('YYYY-MM-DD HH:mm');
                feed_html += feed_template.replace('$title', val.title)
                    .replace('$date', localTime)
                    .replace('$description', marked(val.description))
                    .replace('$key', val.key);
              });
              $("#event-feed").html(feed_html);
            }).fail(function(data){
              $("#event-feed").html("failed");
            });
        });
    </script>
{% endblock %}
